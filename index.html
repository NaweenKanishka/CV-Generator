<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CV Generator</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f5f5f5;
      color: #333;
    }
    .container {
      display: flex;
      gap: 30px;
      padding: 20px;
      flex-wrap: wrap;
    }
    form {
      flex: 1;
      min-width: 300px;
    }
    #cv-preview {
      flex: 1;
      background: white;
      padding: 30px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      width: 794px;
      min-height: 1123px;
      box-sizing: border-box;
    }
    .section {
      margin-bottom: 30px;
      page-break-inside: avoid;
    }
    .section h2 {
      border-bottom: 1px solid #ccc;
      margin-bottom: 10px;
      font-size: 18px;
    }
    input, textarea {
      width: 100%;
      padding: 6px;
      margin-bottom: 10px;
      border: 1px solid #ccc;
    }
    button {
      padding: 10px 20px;
      background: #333;
      color: white;
      border: none;
      cursor: pointer;
      margin-right: 10px;
    }
    ul {
      padding-left: 20px;
    }
    .bottom-section {
      margin-top: 40px;
      border-top: 1px solid #ccc;
      padding-top: 20px;
    }
    .bottom-section p {
      margin: 5px 0;
    }
    .page-break {
      page-break-before: always;
      break-before: page;
    }

    .subtopic {
      margin-left: 20px;
    }

    hr {
      border: 0;
      border-top: 1px solid #ccc;
      margin: 20px 0;
    }

    @media print {
      .page-break {
        page-break-before: always;
        break-before: page;
      }
    }
  </style>
</head>
<body>
  <h1 style="padding: 20px">CV Generator</h1>
  <div class="container">
    <form id="cv-form">
      <h2>Basic Info</h2>
      <input type="text" id="name" placeholder="Full Name" />
      <input type="text" id="title" placeholder="Job Title" />
      <input type="text" id="phone" placeholder="Phone Number" />
      <input type="text" id="email" placeholder="Email" />
      <input type="text" id="linkedin" placeholder="LinkedIn URL" />
      <textarea id="summary" placeholder="Professional Summary"></textarea>

      <h2>Dynamic Sections</h2>
      <div id="dynamic-sections">
        <div class="dynamic-section">
          <input type="text" class="section-title" placeholder="Section Title (e.g., Projects)" />
          <textarea class="section-content" placeholder="Content for the section"></textarea>
          <h3>Subtopics</h3>
          <div class="subtopics-container">
            <div class="subtopic-container">
              <input type="text" class="subtopic-title" placeholder="Subtopic Title" />
              <textarea class="subtopic-content" placeholder="Bullet points (separate with newline)"></textarea>
            </div>
          </div>
          <button type="button" onclick="addSubtopic(this)">Add Subtopic</button>
        </div>
      </div>
      <button type="button" onclick="addSection()">Add Another Section</button>

      <input type="text" id="dateInput" placeholder="Date (e.g. April 19, 2025)" />

      <button type="button" onclick="updatePreview()">Update Preview</button>
      <button type="button" onclick="downloadPDF()">Download PDF</button>
    </form>

    <div id="cv-preview">
      <h1 id="preview-name">Your Name</h1>
      <h3 id="preview-title">Job Title</h3>
      <p><strong>Phone:</strong> <span id="preview-phone"></span> &nbsp;&nbsp;
        <strong>LinkedIn:</strong> <span id="preview-linkedin"></span><br>
        <strong>Email:</strong> <span id="preview-email"></span></p>

      <p id="preview-summary"></p>

      <!-- Dynamically added sections will appear here -->
      <div id="preview-dynamic-sections"></div>

      <div class="bottom-section">
        <p><strong>References:</strong> Available upon request</p>
        <p><strong>Date:</strong> <span id="preview-date"></span></p>
      </div>
    </div>
  </div>

  <script>
    function addSection() {
      const sectionContainer = document.createElement('div');
      sectionContainer.classList.add('dynamic-section');
      
      const sectionTitle = document.createElement('input');
      sectionTitle.classList.add('section-title');
      sectionTitle.setAttribute('type', 'text');
      sectionTitle.setAttribute('placeholder', 'Section Title (e.g., Projects)');
      
      const sectionContent = document.createElement('textarea');
      sectionContent.classList.add('section-content');
      sectionContent.setAttribute('placeholder', 'Content for the section');

      const subtopicsContainer = document.createElement('div');
      subtopicsContainer.classList.add('subtopics-container');

      const subtopicContainer = document.createElement('div');
      subtopicContainer.classList.add('subtopic-container');
      
      const subtopicTitle = document.createElement('input');
      subtopicTitle.classList.add('subtopic-title');
      subtopicTitle.setAttribute('type', 'text');
      subtopicTitle.setAttribute('placeholder', 'Subtopic Title');
      
      const subtopicContent = document.createElement('textarea');
      subtopicContent.classList.add('subtopic-content');
      subtopicContent.setAttribute('placeholder', 'Bullet points (separate with newline)');

      subtopicContainer.appendChild(subtopicTitle);
      subtopicContainer.appendChild(subtopicContent);
      
      subtopicsContainer.appendChild(subtopicContainer);
      
      const addSubtopicButton = document.createElement('button');
      addSubtopicButton.textContent = "Add Subtopic";
      addSubtopicButton.setAttribute('type', 'button');
      addSubtopicButton.onclick = function() {
        addSubtopic(sectionContainer);
      };

      sectionContainer.appendChild(sectionTitle);
      sectionContainer.appendChild(sectionContent);
      sectionContainer.appendChild(subtopicsContainer);
      sectionContainer.appendChild(addSubtopicButton);

      document.getElementById('dynamic-sections').appendChild(sectionContainer);
    }

    function addSubtopic(sectionContainer) {
      const subtopicContainer = document.createElement('div');
      subtopicContainer.classList.add('subtopic-container');
      
      const subtopicTitle = document.createElement('input');
      subtopicTitle.classList.add('subtopic-title');
      subtopicTitle.setAttribute('type', 'text');
      subtopicTitle.setAttribute('placeholder', 'Subtopic Title');
      
      const subtopicContent = document.createElement('textarea');
      subtopicContent.classList.add('subtopic-content');
      subtopicContent.setAttribute('placeholder', 'Bullet points (separate with newline)');

      subtopicContainer.appendChild(subtopicTitle);
      subtopicContainer.appendChild(subtopicContent);
      
      sectionContainer.querySelector('.subtopics-container').appendChild(subtopicContainer);
    }

    function updatePreview() {
      document.getElementById("preview-name").innerText = document.getElementById("name").value || "Your Name";
      document.getElementById("preview-title").innerText = document.getElementById("title").value || "Job Title";
      document.getElementById("preview-phone").innerText = document.getElementById("phone").value || "";
      document.getElementById("preview-email").innerText = document.getElementById("email").value || "";
      document.getElementById("preview-linkedin").innerText = document.getElementById("linkedin").value || "";
      document.getElementById("preview-summary").innerText = document.getElementById("summary").value || "";
      document.getElementById("preview-date").innerText = document.getElementById("dateInput").value || "";

      const dynamicSectionsPreview = document.getElementById("preview-dynamic-sections");
      dynamicSectionsPreview.innerHTML = ''; // Reset preview

      const sections = document.querySelectorAll('.dynamic-section');
      
      sections.forEach(section => {
        const sectionTitle = section.querySelector('.section-title').value.trim();
        const sectionContent = section.querySelector('.section-content').value.trim();

        if (sectionTitle && sectionContent) {
          const sectionDiv = document.createElement('div');
          const sectionTitleElem = document.createElement('h2');
          sectionTitleElem.innerText = sectionTitle;
          const sectionContentElem = document.createElement('p');
          sectionContentElem.innerText = sectionContent;

          sectionDiv.appendChild(sectionTitleElem);
          sectionDiv.appendChild(sectionContentElem);

          // Process subtopics
          const subtopicsContainer = section.querySelector('.subtopics-container');
          const subtopicElems = [];
          const subtopicContainers = subtopicsContainer.querySelectorAll('.subtopic-container');

          subtopicContainers.forEach(subtopicContainer => {
            const subtopicTitle = subtopicContainer.querySelector('.subtopic-title').value.trim();
            const subtopicContent = subtopicContainer.querySelector('.subtopic-content').value.trim();
            
            if (subtopicTitle && subtopicContent) {
              const subtopicDiv = document.createElement('div');
              const subtopicTitleElem = document.createElement('h3');
              subtopicTitleElem.innerText = subtopicTitle;
              const subtopicContentElem = document.createElement('ul');
              const subtopicPoints = subtopicContent.split('\n');
              
              subtopicPoints.forEach(point => {
                const listItem = document.createElement('li');
                listItem.innerText = point;
                subtopicContentElem.appendChild(listItem);
              });

              subtopicDiv.appendChild(subtopicTitleElem);
              subtopicDiv.appendChild(subtopicContentElem);
              subtopicElems.push(subtopicDiv);
            }
          });

          subtopicElems.forEach(subtopic => sectionDiv.appendChild(subtopic));
          dynamicSectionsPreview.appendChild(sectionDiv);
          dynamicSectionsPreview.appendChild(document.createElement('hr')); // Add line after each section
        }
      });
    }

    function downloadPDF() {
      const element = document.getElementById("cv-preview");
      const options = {
        filename: "cv.pdf",
        image: { type: "jpeg", quality: 0.98 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: "mm", format: "a4", orientation: "portrait" }
      };
      html2pdf().from(element).set(options).save();
    }
  </script>
</body>
</html>
